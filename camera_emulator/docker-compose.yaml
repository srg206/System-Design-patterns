services:
  mediamtx:
    image: bluenviron/mediamtx:latest
    container_name: mediamtx
    ports:
      - "8554:8554"   # RTSP
      - "1935:1935"   # RTMP
      - "8888:8888"   # HLS
      - "8889:8889"   # WebRTC
    volumes:
      - ./mediamtx.yml:/mediamtx.yml
    restart: unless-stopped

  rtsp-publisher:
    image: linuxserver/ffmpeg:latest
    container_name: rtsp-publisher
    depends_on:
      - mediamtx
    volumes:
      - ./video.mp4:/video.mp4:ro
    entrypoint: >
      /bin/sh -c "
        sleep 3 &&
        ffmpeg -re -stream_loop -1 -i /video.mp4
        -c copy
        -f rtsp
        -rtsp_transport tcp
        rtsp://mediamtx:8554/mystream
      "
    restart: unless-stopped

